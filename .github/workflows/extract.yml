name: Update EE.m3u

on:
  schedule:
    - cron: '0 6 * * *'
    - cron: '0 17 * * *'
  workflow_dispatch:

jobs:
  update:
    runs-on: ubuntu-latest
    
    steps:
      - uses: actions/checkout@v4
      
      - uses: actions/setup-python@v4
        with:
          python-version: '3.10'
      
      - name: Install requests
        run: pip install requests
      
      - name: Run simple script
        working-directory: ./scripts
        run: python tv_extractor.py
      
      - name: Quick check
        run: |
          echo "检查结果:"
          if [ -f "EE.m3u" ]; then
            echo "✅ EE.m3u已生成"
            echo "大小: $(wc -c < EE.m3u) bytes"
            echo "频道数: $(grep -c "#EXTINF" EE.m3u || echo 0)"
            
            now_news=$(grep -c "NOW新闻台\|NOW新聞台" EE.m3u || echo 0)
            echo "NOW新闻台数量: $now_news"
            
            if [ "$now_news" -gt 1 ]; then
              echo "⚠️  NOW新闻台可能重复"
            fi
          else
            echo "❌ 文件未生成"
            exit 1
          fi
      
      - name: Commit
        run: |
          git config user.name "GitHub Actions"
          git config user.email "actions@github.com"
          git add EE.m3u
          git commit -m "Update EE.m3u" || exit 0
          git pull --rebase origin main
          git push origin main
